<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/principled-graphql/styles.5f472a48062a1bcb0e9c.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}@font-face{font-family:Source Code Pro;font-style:normal;font-weight:400;src:local("Source Code Pro Regular"),local("SourceCodePro-Regular"),url(https://fonts.gstatic.com/s/sourcecodepro/v11/HI_SiYsKILxRpg3hIP6sJ7fM7PqlPevT.ttf) format("truetype")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:400;src:local("Source Sans Pro Regular"),local("SourceSansPro-Regular"),url(https://fonts.gstatic.com/s/sourcesanspro/v13/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7g.ttf) format("truetype")}@font-face{font-family:Source Sans Pro;font-style:normal;font-weight:600;src:local("Source Sans Pro SemiBold"),local("SourceSansPro-SemiBold"),url(https://fonts.gstatic.com/s/sourcesanspro/v13/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlxdr.ttf) format("truetype")}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}body{font-family:Source Sans Pro,sans-serif}code,pre{font-family:Source Code Pro,monospace}html{font-size:100%;line-height:1.45;overflow-y:auto}body{color:#5a6270}h1,h2,h3,h4,h5,h6,img.screenshot,ol,p,ul{margin:0 0 1.45rem}h4,h5{margin-bottom:1.0875rem}h1,h2,h3,h4,h5,h6{line-height:1.1;color:#2f353f}h1,h2,h3,h4,h6{font-weight:400}h1{font-size:2.5rem}h2{font-size:1.73286rem}h3{font-size:1.4427rem}h4,li,p{font-size:1.125rem}h5{font-size:1rem}h6{font-size:.875rem}li,p{line-height:1.7}ol,ul{margin-left:1.45rem;padding:0}li{margin-bottom:.725rem}li>ol,li>ul{margin-top:.725rem}blockquote{margin-left:0;padding:12px 20px;border-left:2px solid #3f20ba}blockquote>p{font-size:inherit}blockquote>p:last-child,form{margin-bottom:0}hr{height:1px;margin-bottom:calc(1.45rem - 1px);border:none;background-color:#dee2e7}img.screenshot{box-shadow:0 0 0 1px rgba(18,21,26,.04),0 1px 4px 0 rgba(0,0,0,.08);border-radius:8px}</style><meta name="generator" content="Gatsby 2.23.11"/><title data-react-helmet="true">Operations Principles - Principled GraphQL</title><link data-react-helmet="true" rel="icon" href="https://apollographql.com/favicon.ico"/><meta data-react-helmet="true" name="description" content="Best practices for implementing and scaling a graph"/><meta data-react-helmet="true" property="og:title" content="Operations Principles"/><meta data-react-helmet="true" property="og:site_name" content="Principled GraphQL"/><meta data-react-helmet="true" property="og:description" content="Securely deploying the graph to production at scale"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="Operations Principles"/><meta data-react-helmet="true" name="twitter:description" content="Securely deploying the graph to production at scale"/><meta data-react-helmet="true" name="twitter:site" content="@apollographql"/><meta data-react-helmet="true" property="og:image" content="/principled-graphql/static/og-image-f5034df8c60c72f6dacce2caf516306a.png"/><meta data-react-helmet="true" name="twitter:image" content="https://principledgraphql.com/principled-graphql/static/og-image-f5034df8c60c72f6dacce2caf516306a.png"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link as="script" rel="preload" href="/principled-graphql/webpack-runtime-c80710544268f9f792a5.js"/><link as="script" rel="preload" href="/principled-graphql/framework-0f7f24c8879fa60fb4d3.js"/><link as="script" rel="preload" href="/principled-graphql/app-abe168bb83580ae8a2f4.js"/><link as="script" rel="preload" href="/principled-graphql/styles-c6fefb7f482bcee5f133.js"/><link as="script" rel="preload" href="/principled-graphql/component---src-components-template-js-d75477c13a30a41d3287.js"/><link as="fetch" rel="preload" href="/principled-graphql/page-data/operations/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/principled-graphql/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="bzzyjq">.css-bzzyjq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-height:100vh;max-width:1440px;margin:0 auto;}</style><div class="css-bzzyjq exdt29b0"><style data-emotion-css="1bs7gxh">.css-1bs7gxh{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:312px;height:100vh;padding:24px;border-right:1px solid #DEE2E7;overflow-y:auto;position:-webkit-sticky;position:sticky;top:0;}@media (max-width:850px){.css-1bs7gxh{height:100%;background-color:white;box-shadow:0 0 48px rgba(0,0,0,0.25);position:fixed;z-index:2;opacity:0;visibility:hidden;-webkit-transform:translateX(-100%);-ms-transform:translateX(-100%);transform:translateX(-100%);-webkit-transition-property:-webkit-transform,opacity,visibility;-webkit-transition-property:transform,opacity,visibility;transition-property:transform,opacity,visibility;-webkit-transition-duration:150ms;transition-duration:150ms;-webkit-transition-timing-function:ease-in-out;transition-timing-function:ease-in-out;}}</style><aside class="css-1bs7gxh ezgpdot1"><style data-emotion-css="7ieosi">.css-7ieosi{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:24px;}</style><div class="css-7ieosi ezgpdot2"><style data-emotion-css="gbkvvb">.css-gbkvvb{color:#2F353F;-webkit-text-decoration:none;text-decoration:none;}</style><a href="/" class="css-gbkvvb ezgpdot3"><h4 style="margin-bottom:0">Principled GraphQL</h4></a></div><div><div><style data-emotion-css="1s7b6x">.css-1s7b6x{position:relative;z-index:0;}.css-1s7b6x .ea7mcww1{position:relative;z-index:2;}</style><div class="css-1s7b6x ea7mcww3"><style data-emotion-css="mzx0jx">.css-mzx0jx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px 0;color:#2F353F;font-weight:bold;font-size:14px;line-height:15px;-webkit-letter-spacing:0.142em;-moz-letter-spacing:0.142em;-ms-letter-spacing:0.142em;letter-spacing:0.142em;text-transform:uppercase;-webkit-text-decoration:none;text-decoration:none;}.css-mzx0jx svg{height:10px;width:10px;}.css-mzx0jx.active{color:#3f20ba;}.css-mzx0jx:hover{opacity:0.8;}</style><a class="css-mzx0jx ea7mcww5" href="/principled-graphql/integrity">Integrity Principles</a><style data-emotion-css="1kjoysr">.css-1kjoysr{margin-left:0;margin-bottom:32px;list-style:none;}</style><ul class="css-1kjoysr ea7mcww1"><style data-emotion-css="xjzpx7">.css-xjzpx7{font-size:1rem;line-height:1.5;margin-bottom:0.8125rem;}.css-xjzpx7 a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-xjzpx7 a:hover{opacity:0.8;}.css-xjzpx7 a.active{color:#3f20ba;pointer-events:none;}</style><li class="css-xjzpx7 ea7mcww2"><a title="Your company should have one unified graph, instead of multiple graphs created by each team." href="/principled-graphql/integrity#1-one-graph">1. One Graph</a></li><li class="css-xjzpx7 ea7mcww2"><a title="Though there is only one graph, the implementation of that graph should be federated across multiple teams." href="/principled-graphql/integrity#2-federated-implementation">2. Federated Implementation</a></li><li class="css-xjzpx7 ea7mcww2"><a title="There should be a single source of truth for registering and tracking the graph." href="/principled-graphql/integrity#3-track-the-schema-in-a-registry">3. Track the Schema in a Registry</a></li></ul></div><div class="css-1s7b6x ea7mcww3"><a class="css-mzx0jx ea7mcww5" href="/principled-graphql/agility">Agility Principles</a><ul class="css-1kjoysr ea7mcww1"><li class="css-xjzpx7 ea7mcww2"><a title="The schema should act as an abstraction layer that provides flexibility to consumers while hiding service implementation details." href="/principled-graphql/agility#4-abstract-demand-oriented-schema">4. Abstract, Demand-Oriented Schema</a></li><li class="css-xjzpx7 ea7mcww2"><a title="The schema should be built incrementally based on actual requirements and evolve smoothly over time." href="/principled-graphql/agility#5-use-an-agile-approach-to-schema-development">5. Use an Agile Approach to Schema Development</a></li><li class="css-xjzpx7 ea7mcww2"><a title="Performance management should be a continuous, data-driven process, adapting smoothly to changing query loads and service implementations." href="/principled-graphql/agility#6-iteratively-improve-performance">6. Iteratively Improve Performance</a></li><li class="css-xjzpx7 ea7mcww2"><a title="Developers should be equipped with rich awareness of the graph throughout the entire development process." href="/principled-graphql/agility#7-use-graph-metadata-to-empower-developers">7. Use Graph Metadata to Empower Developers</a></li></ul></div><div class="css-1s7b6x ea7mcww3"><a aria-current="page" class="css-mzx0jx ea7mcww5" href="/principled-graphql/operations">Operations Principles</a><ul class="css-1kjoysr ea7mcww1"><li class="css-xjzpx7 ea7mcww2"><a title="Grant access to the graph on a per-client basis, and manage what and how clients can access it." href="/principled-graphql/operations#8-access-and-demand-control">8. Access and Demand Control</a></li><li class="css-xjzpx7 ea7mcww2"><a title="Capture structured logs of all graph operations and leverage them as the primary tool for understanding graph usage." href="/principled-graphql/operations#9-structured-logging">9. Structured Logging</a></li><li class="css-xjzpx7 ea7mcww2"><a title="Adopt a layered architecture with graph functionality broken into a separate tier rather than baked into every service." href="/principled-graphql/operations#10-separate-the-graphql-layer-from-the-service-layer">10. Separate the GraphQL Layer from the Service Layer</a></li></ul></div></div><style data-emotion-css="1wsccn1">.css-1wsccn1{line-height:24px;}</style><h4 class="css-1wsccn1 e1nuktnm2">Learn how to apply these ten principles with the Apollo Graph Platform</h4><style data-emotion-css="1blk7qo">.css-1blk7qo{background:#3f20ba;border-radius:4px;color:#fff;padding:12px 34px;-webkit-text-decoration:none;text-decoration:none;display:inline-block;}.css-1blk7qo:hover{background:#311C87;}</style><a href="https://apollographql.com?utm_medium=website&amp;utm_source=principledgraphql.com&amp;utm_campaign=sidebar-cta&amp;utm_content=sidebar" target="_blank" rel="noopener noreferrer" class="css-1blk7qo e1nuktnm3">Get Started</a></div></aside><style data-emotion-css="i9gxme">.css-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><main class="css-i9gxme e1nuktnm1"><style data-emotion-css="1xovgjc">.css-1xovgjc{display:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:64px;width:100%;padding:0 24px;position:-webkit-sticky;position:sticky;top:0;color:#2F353F;background-color:white;z-index:1;}@media (max-width:850px){.css-1xovgjc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><div class="css-1xovgjc e1nuktnm0"><style data-emotion-css="1m6zll5">.css-1m6zll5{padding:20px;margin-left:-20px;color:inherit;border:none;background:none;outline:none;cursor:pointer;}</style><button class="css-1m6zll5 e1qf1exz0"><style data-emotion-css="1ihqbbj">.css-1ihqbbj{height:24px;width:24px;display:block;fill:currentColor;}</style><style data-emotion-css="yixxh9">.css-yixxh9{overflow:visible;height:24px;height:24px;width:24px;display:block;fill:currentColor;}.css-yixxh9 *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 24 24" class="e1qf1exz1 css-yixxh9"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M2.25 18.003h19.5M2.25 12.003h19.5M2.25 6.003h19.5"></path></g></svg></button><h4 style="margin-bottom:0">Principled GraphQL</h4></div><style data-emotion-css="407w1l">.css-407w1l{padding:40px 56px;}@media (max-width:850px){.css-407w1l{padding:32px 48px;}}@media (max-width:600px){.css-407w1l{padding:24px 32px;}}</style><div class="css-407w1l e10qqp480"><style data-emotion-css="70qvj9">.css-70qvj9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><h1 class="css-70qvj9 eq8cl420"><style data-emotion-css="5qtkjr">.css-5qtkjr{height:2.5em;width:2.5em;margin:0;margin-right:0.25em;}</style><img src="/principled-graphql/static/763ec54a971a5ced9b745302e60f5bd3/operations.png" alt="Operations Principles logo" class="css-5qtkjr eq8cl422"/><span>Operations Principles<style data-emotion-css="lixhkq">.css-lixhkq{display:block;margin-top:4px;margin-bottom:4px;color:#5A6270;}</style><h4 class="css-lixhkq eq8cl421">Securely deploying the graph to production at scale</h4></span></h1><hr/><style data-emotion-css="1vxx5vo">.css-1vxx5vo a{color:#3f20ba;-webkit-text-decoration:none;text-decoration:none;}.css-1vxx5vo a:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-1vxx5vo .anchor{color:inherit;}.css-1vxx5vo .anchor svg{fill:currentColor;}.css-1vxx5vo h2:not(:first-child){margin-top:56px;}.css-1vxx5vo .float{width:50%;margin-left:24px;margin-bottom:24px;float:right;}.css-1vxx5vo .float img{width:100%;}@media (max-width:600px){.css-1vxx5vo .float{width:100%;margin-left:0;float:none;}}</style><div class="css-1vxx5vo eq8cl423"><div><h2 id="8-access-and-demand-control" style="position:relative;"><a href="#8-access-and-demand-control" aria-label="8 access and demand control permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8. Access and Demand Control</h2>
<blockquote>
<p>Grant access to the graph on a <strong>per-client basis</strong>, and manage <strong>what</strong> and <strong>how</strong> clients can access it.</p>
</blockquote>
<p>Authorization in a graph has two equally important aspects: access control, which dictates which objects and fields a user is allowed to access, and demand control, which dictates how (and how much) the user is allowed to access those resources. While access control is often talked about, attention also needs to be given to demand control, since it is critical in any production deployment of GraphQL. It is a mistake to allow users to perform any possible query regardless of cost, with no ability to manage its impact on production systems. Both access and demand control must be performed with full awareness of the semantics and performance of the graph. It's not sufficient to limit a user to particular number of queries per minute without an analysis of the queries actually being sent, as a query could access a wide universe of services and the cost of a query can vary over multiple orders of magnitude.</p>
<p>Authentication in a graph also has two aspects: the app that is requesting the operation, and the person that is using the app. While access control may center on the person using the app, proper demand control depends at least as much on per-app controls as it does on per-person controls, as it is the developer of the app, not the user of the app, that is responsible for the particular query shapes that the app uses to do its job.</p>
<p>Best practices for demand control include:</p>
<ul>
<li>When untrusted users are accessing production systems, they should only send queries that have been preregistered by the authenticated developer of the app, instead of allowing them to send arbitrary queries with the app's credentials. This is sometimes relaxed for internal apps that are distributed only to trusted users.</li>
<li>For apps that are expected to send large numbers of queries, teams should design a query approval workflow, aligned with the broader software development cycle, to vet queries before they go into production. This ensures that they do not fetch unnecessary data and that server capacity is available to support them.</li>
<li>As a second line of defense, estimating the cost of a query before performing it and instituting per-user and per-app query cost budgets can protect against overuse of preregistered operations or in cases where operation preregistration is not possible.</li>
<li>Developers should be able to disable the ability of particular apps to send particular queries in production, either as a safety net in emergencies or if a third party app is found to be using the graph in unacceptable ways.</li>
</ul>
<h2 id="9-structured-logging" style="position:relative;"><a href="#9-structured-logging" aria-label="9 structured logging permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>9. Structured Logging</h2>
<blockquote>
<p>Capture <strong>structured logs</strong> of all graph operations and leverage them as the primary tool for understanding graph usage.</p>
</blockquote>
<p>A wealth of information can be captured about each operation (read or write) that is performed on a graph: what user and app performed the operation, what fields were accessed, how the operation was actually executed, how it performed, and more. This information is highly valuable and should be systematically captured and made available for later use. Instead of a text log, it should be captured in a structured, machine readable format so that it can be leveraged for as many purposes as possible.</p>
<p>The record of a graph operation is called a <strong>trace</strong>. A trace should bring together all pertinent information about an operation in one place, including business information (who performed the operation, what was accessed or changed, which feature of which app built by which developer, whether it succeeded, how it performed) and purely technical information (which backend services were contacted, how each service contributed to latency, whether caches were used). </p>
<p>Because traces truly capture how a graph is being used, they can be used for a wide range of purposes:</p>
<ul>
<li>Understanding whether a deprecated field can be removed, or if not, the specific clients that are still accessing it and how important they are</li>
<li>Predicting how long a query will take to execute – in realtime, as the developer is typing the query in their IDE – based on live production data</li>
<li>Automatically detecting problems in production (such as increased latency or error rates) and diagnosing their root cause</li>
<li>Providing an authoritative audit trail showing which users have accessed a particular record</li>
<li>Powering business intelligence queries (do people search for ice cream more often when it is hot where they are?)</li>
<li>Generating invoices for partners based on API usage, with the possibility of a detailed cost model based on either the particular fields accessed or the resources consumed</li>
</ul>
<p>Traces for all graph operations should be collected in one central place, so that there is one authoritative stream of traces. This stream can then be piped into other observability systems (perhaps after a simple transformation for existing systems that are not GraphQL-aware), or stored in one or more data warehouses for later use (aggregated and sampled as budget, use cases, and scale require). </p>
<h2 id="10-separate-the-graphql-layer-from-the-service-layer" style="position:relative;"><a href="#10-separate-the-graphql-layer-from-the-service-layer" aria-label="10 separate the graphql layer from the service layer permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>10. Separate the GraphQL Layer from the Service Layer</h2>
<blockquote>
<p>Adopt a <strong>layered architecture</strong> with graph functionality broken into a separate tier rather than baked into every service.</p>
</blockquote>
<p>In most API technologies, clients do not talk directly to servers, except possibly in development. Instead, a layered approach is adopted in which some concerns such as load balancing, caching, service location, or API key management are split into a separate tier. This tier can then be designed, operated, and scaled separately from the backend services.</p>
<p>It's no different with GraphQL. Rather than baking all of the functionality needed for a complete graph system into each and every service, most graph functionality should be factored out into a separate tier that sits in between clients and services, leaving each service to focus on serving the actual client request. This tier, which can be composed of multiple processes, performs functions such as access and demand control, federation, trace collection, and potentially caching. Some parts of this tier will be GraphQL-specific and require deep awareness of the graph, while other functions such as load balancing and client authentication can likely be performed by systems that are already in place.</p>
<p>This separate tier is valuable even in simple scenarios with only one app and only one service; otherwise, functionality that properly belongs in the middle tier will have to be implemented in the server. In complex applications, this tier may start to look like a geographically distributed system: receiving incoming queries through multiple ingress points, processing some of them on the edge of the network with the benefit of edge caches, routing subcomponents of the queries to multiple data centers in the public cloud, privately operated, or operated by partners, and finally assembling these components into a query result, all while recording a trace that memorializes the entire operation.</p>
<p>In some cases, this graph tier will talk to the backend services using GraphQL. But, most frequently, the backend services are left untouched and continue to be accessed by their existing APIs, such as REST, SOAP, gRPC, Thrift, or even SQL, with the mapping from these APIs to graph objects accomplished by servers that form one part of the graph tier.</p>
<!-- end --></div></div><style data-emotion-css="9ckfit">.css-9ckfit{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:64px 0;}@media (max-width:850px){.css-9ckfit{padding:32px 0;}}</style><nav class="css-9ckfit e1sfxy7w0"><style data-emotion-css="spe9v1">.css-spe9v1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-spe9v1 svg{height:16px;width:16px;}.css-spe9v1:hover{opacity:0.8;}</style><a class="css-spe9v1 e1sfxy7w1" href="/principled-graphql/agility"><style data-emotion-css="1a134qk">.css-1a134qk{overflow:visible;height:24px;}.css-1a134qk *{vector-effect:non-scaling-stroke;}</style><svg viewBox="0 0 14 24" class="css-1a134qk"><path fill="none" fill-rule="evenodd" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12.5.75L1.78 11.47a.749.749 0 0 0-.001 1.059l.001.001L12.5 23.25"></path></svg><style data-emotion-css="16mhdhi">.css-16mhdhi{margin-left:24px;text-align:left;}@media (max-width:850px){.css-16mhdhi{margin-left:16px;}}</style><div class="css-16mhdhi e1sfxy7w2"><style data-emotion-css="1vhhq4p">.css-1vhhq4p{-webkit-letter-spacing:0.142em;-moz-letter-spacing:0.142em;-ms-letter-spacing:0.142em;letter-spacing:0.142em;text-transform:uppercase;font-size:12px;}</style><div class="css-1vhhq4p e1sfxy7w3">Previous</div><style data-emotion-css="mtbysh">.css-mtbysh{color:#2F353F;}</style><div class="css-mtbysh e1sfxy7w4">Agility Principles</div></div></a></nav></div><style data-emotion-css="1cqk1h9">.css-1cqk1h9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:32px;font-size:14px;color:#2F353F;border-top:1px solid #DEE2E7;}</style><footer class="css-1cqk1h9 e9dbzwm0"><h4 style="margin-bottom:0">Principled GraphQL</h4><style data-emotion-css="ub303p">.css-ub303p{margin-top:8px;margin-bottom:20px;}.css-ub303p a{color:#3f20ba;-webkit-text-decoration:none;text-decoration:none;}.css-ub303p a:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><span class="css-ub303p e9dbzwm1">Written by <a href="https://twitter.com/GeoffQL">Geoff Schmidt</a> and<!-- --> <a href="https://twitter.com/debergalis">Matt DeBergalis</a></span><style data-emotion-css="o8u0d7">.css-o8u0d7{width:100%;max-width:400px;}</style><hr class="css-o8u0d7 e9dbzwm4"/><style data-emotion-css="1nlbben">.css-1nlbben{text-align:center;}.css-1nlbben a{margin:0 12px;color:inherit;-webkit-text-decoration:none;text-decoration:none;}.css-1nlbben a:hover{-webkit-text-decoration:underline;text-decoration:underline;}</style><nav class="css-1nlbben e9dbzwm2"><a href="https://github.com/apollographql/principled-graphql">View source code</a><style data-emotion-css="1fhgjcy">.css-1fhgjcy{margin-top:4px;}</style><div class="css-1fhgjcy e9dbzwm3"><a href="https://apollographql.com">ApolloGraphQL.com</a> |<!-- --> <a href="https://graphql-summit-2019.eventbrite.com">GraphQL Summit</a></div></nav></footer></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-74643563-15', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/operations";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-abe168bb83580ae8a2f4.js"],"component---node-modules-gatsby-theme-apollo-core-src-pages-404-js":["/component---node-modules-gatsby-theme-apollo-core-src-pages-404-js-c58e951e825bbfc14422.js"],"component---src-components-template-js":["/component---src-components-template-js-d75477c13a30a41d3287.js"]};/*]]>*/</script><script src="/principled-graphql/component---src-components-template-js-d75477c13a30a41d3287.js" async=""></script><script src="/principled-graphql/styles-c6fefb7f482bcee5f133.js" async=""></script><script src="/principled-graphql/app-abe168bb83580ae8a2f4.js" async=""></script><script src="/principled-graphql/framework-0f7f24c8879fa60fb4d3.js" async=""></script><script src="/principled-graphql/webpack-runtime-c80710544268f9f792a5.js" async=""></script></body></html>